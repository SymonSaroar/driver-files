<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110109-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110109-1');
</script>
<script type="text/javascript" src="../common/version.js"></script>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="description" content="Chapter 17: Driver Installation ‚Äî Advanced Issues"/>
<title>Jungo WinDriver: Chapter 17: Driver Installation ‚Äî Advanced Issues</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-main.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="wd_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Jungo WinDriver
   &#160;
   <span id="projectnumber"></span>
   </div>
   <div id="projectbrief">Official Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('ch17_driver_installation_advanced_issues.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Chapter 17: Driver Installation ‚Äî Advanced Issues </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_chap17"></a> </p>
<h1><a class="anchor" id="ch17_1_windows_inf_files"></a>
17.1. Windows INF Files</h1>
<p >Device information (INF) files are text files that provide information used by the Windows Plug-and-Play mechanism to install software that supports a given hardware device. INF files are required for hardware that identifies itself, such as USB and PCI. An INF file includes all necessary information about a device and the files to be installed. When hardware manufacturers introduce new products, they must create INF files to explicitly define the resources and files required for each class of device.</p>
<p >In some cases, the INF file for your specific device is supplied by the operating system. In other cases, you will need to create an INF file for your device. WinDriver's DriverWizard can generate a specific INF file for your device. The INF file is used to notify the operating system that WinDriver now handles the selected device.</p>
<p >For USB devices, you will not be able to access the device with WinDriver (either from DriverWizard or from the code) without first registering the device to work with <code>windrvr1511.sys</code>. This is done by installing an INF file for the device. DriverWizard will offer to automatically generate the INF file for your device.</p>
<p >You can use DriverWizard to generate the INF file on the development machine and then install the INF file on any machine to which you distribute the driver, as explained in the following sections.</p>
<h2><a class="anchor" id="ch17_1_1_why_should_i_create_an_inf_file"></a>
17.1.1. Why Should I Create an INF File?</h2>
<p >We recommend creating an INF file for the following reasons:</p>
<ul>
<li>To bind the WinDriver kernel module to a specific device.</li>
<li>To override the existing driver (if any).</li>
<li>To enable WinDriver applications and DriverWizard to access a device.</li>
</ul>
<h2><a class="anchor" id="ch17_1_2_how_do_i_install_an_inf_file_when_no_driver_exists"></a>
17.1.2. How Do I Install an INF File When No Driver Exists?</h2>
<p >You must have administrative privileges in order to install an INF file.</p>
<p >You can use the wdreg utility with the install command to automatically install the INF file:</p>
<div class="fragment"><div class="line">wdreg -inf &lt;path to the INF file&gt; install</div>
</div><!-- fragment --><p >On the development PC, you can have the INF file automatically installed when selecting to generate the INF file with DriverWizard, by checking the Automatically Install the INF file option in the DriverWizard's INF generation window (refer to <a class="el" href="ch6_using_driverwizard.html#ch6_2_driverwizard_walkthrough">6.2. DriverWizard Walkthrough</a>).</p>
<p >On the development PC, you can also use the wdreg_frontned utility to install/uninstall INFs and perform other advanced tasks.</p>
<p >It is also possible to install the INF file manually, using either of the following methods:</p>
<ul>
<li>Windows Found New Hardware Wizard: this wizard is activated when the device is plugged in or, if the device was already connected, when scanning for hardware changes from the Device Manager.</li>
<li>Windows Add/Remove Hardware Wizard: right-click the mouse on My Computer, select Properties, choose the Hardware tab and click on Hardware Wizard....</li>
<li>Windows Upgrade Device Driver Wizard: locate the device in the Device Manager devices list and select the Update Driver... option from the right-click mouse menu or from the Device Manager's Action menu.</li>
</ul>
<p >In all the manual installation methods above you will need to point Windows to the location of the relevant INF file during the installation.</p>
<p >We recommend using the wdreg utility to install the INF file automatically, instead of installing it manually.</p>
<p >If the installation fails with an <code>ERROR_FILE_NOT_FOUND</code> error, inspect the Windows registry to see if the RunOnce key exists in <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion</code>. This registry key is required by Windows Plug-and-Play in order to properly install drivers using INF files. If the RunOnce key is missing, create it; then try installing the INF file again.</p>
<h2><a class="anchor" id="ch17_1_3_how_do_i_replace_an_existing_driver_using_the_inf_file"></a>
17.1.3. How Do I Replace an Existing Driver Using the INF File?</h2>
<p >You must have administrative privileges in order to replace a driver.</p>
<ul>
<li>Install your INF file.</li>
</ul>
<p >You can use the wdreg utility with the install command to automatically install the INF file:</p>
<div class="fragment"><div class="line">wdreg -inf &lt;path to INF file&gt; install</div>
</div><!-- fragment --><p >On the development PC, you can have the INF file automatically installed when selecting to generate the INF file with DriverWizard, by checking the Automatically Install the INF file option in the DriverWizard's INF generation window. On the development PC, you can also use the <code>wdreg_frontned</code> utility to install/uninstall INFs and perform other advanced tasks.</p>
<p >It is also possible to install the INF file manually, using either of the following methods:</p>
<ul>
<li>Windows Found New Hardware Wizard: this wizard is activated when the device is plugged in or, if the device was already connected, when scanning for hardware changes from the Device Manager.</li>
<li>Windows Add/Remove Hardware Wizard: right-click on My Computer, select Properties, choose the Hardware tab and click on Hardware Wizard....</li>
<li>Windows Upgrade Device Driver Wizard: locate the device in the Device Manager devices list and select the Update Driver... option from the right-click mouse menu or from the Device Manager's Action menu.</li>
</ul>
<p >In the manual installation methods above you will need to point Windows to the location of the relevant INF file during the installation. If the installation wizard offers to install an INF file other than the one you have generated, select <b>Install one of the other drivers</b> and choose your specific INF file from the list.</p>
<p >We recommend using the wdreg utility to install the INF file automatically, instead of installing it manually.</p>
<p >If the installation fails with an <code>ERROR_FILE_NOT_FOUND</code> error, inspect the Windows registry to see if the RunOnce key exists in <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion</code>. This registry key is required by Windows Plug-and-Play in order to properly install drivers using INF files. If the RunOnce key is missing, create it; then try installing the INF file again.</p>
<h1><a class="anchor" id="ch17_2_renaming_the_windriver_kernel_driver"></a>
17.2. Renaming the WinDriver Kernel Driver</h1>
<p >The WinDriver APIs are implemented within the WinDriver kernel driver module (<code>windrvr1511.sys/.dll/.ko</code> ‚Äî depending on the OS), which provides the main driver functionality and enables you to code your specific driver logic from the user mode.</p>
<p >On Windows and Linux you can change the name of the WinDriver kernel module to your preferred driver name, and then distribute the renamed driver instead of the default kernel module ‚Äî <code>windrvr1511.sys/.dll/.ko</code>. The following sections explain how to rename the driver for each of the supported operating systems.</p>
<p >For information on how to use the Debug Monitor to log debug messages from your renamed driver, refer to <a class="el" href="ch8_debugging_drivers.html#ch8_2_1_3_running_wddebug_gui_for_a_renamed_driver">8.2.1.3. Running wddebug_gui for a Renamed Driver</a> : Running wddebug_gui for a Renamed Driver.</p>
<p >A renamed WinDriver kernel driver can be installed on the same machine as the original kernel module. You can also install multiple renamed WinDriver drivers on the same machine, simultaneously.</p>
<blockquote class="doxtable">
<p >&zwj;<b>üí° Recommendation</b></p>
<blockquote class="doxtable">
<p >&zwj;Try to give your driver a unique name in order to avoid a potential conflict with other drivers on the target machine on which your driver will be installed. </p>
</blockquote>
</blockquote>
<h2><a class="anchor" id="ch17_2_1_windows_driver_renaming"></a>
17.2.1. Windows Driver Renaming</h2>
<p >DriverWizard automates most of the work of renaming the Windows WinDriver kernel driver ‚Äî <code>windrvr1511.sys</code>.</p>
<p >When renaming the driver, the CPU architecture (32-/64-bit) of the development platform and its WinDriver installation, should match the target platform.</p>
<p >Renaming the signed <code>windrvr1511.sys</code> driver nullifies its signature. In such cases you can select either to sign your new driver, or to distribute an unsigned driver. For more information on driver signing and certification, refer to <a class="el" href="ch17_driver_installation_advanced_issues.html#ch17_3_windows_digital_driver_signing_and_certification">17.3. Windows Digital Driver Signing and Certification</a>. For guidelines for signing and certifying your renamed driver, refer to <a class="el" href="ch17_driver_installation_advanced_issues.html#ch17_3_2_driver_signing_and_certification_of_windriver-based_drivers">17.3.2. Driver Signing and Certification of WinDriver-Based Drivers</a>.</p>
<blockquote class="doxtable">
<p >&zwj;<b>‚ö† Attention</b></p>
<blockquote class="doxtable">
<p >&zwj;References to xxx in this section should be replaced with the name of your generated DriverWizard driver project. </p>
</blockquote>
</blockquote>
<p>To rename your Windows WinDriver kernel driver, follow these steps:</p>
<ul>
<li>Use the DriverWizard utility to generate driver code for your hardware on Windows (refer to <a class="el" href="ch6_using_driverwizard.html#ch6_2_driverwizard_walkthrough">6.2. DriverWizard Walkthrough</a>), using your preferred driver name (<code>xxx</code>) as the name of the generated driver project. The generated project directory (<code>xxx</code>) will include an xxx_installation directory with the following files and directories:<ul>
<li><code>redist</code> directory: <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">File &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>xxx.sys</code>   </td><td class="markdownTableBodyLeft">Your new driver, which is actually a renamed copy of the <code>windrvr1511.sys</code> driver. The properties of the generated driver file (such as the file's version, company name, etc.) are identical to the properties of the original <code>windrvr1511.sys</code> driver. You can rebuild the driver with new properties using the files from the generated <code>xxx_installation\sys</code> directory, as explained below.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>xxx_driver.inf</code>   </td><td class="markdownTableBodyLeft">A modified version of the <code>windrvr1511.inf</code> file, which will be used to install your new <code>xxx.sys</code> driver. You can make additional modifications to this file, if you wish ‚Äî namely, changing the string definitions and/or comments in the file.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>xxx_device.inf</code>   </td><td class="markdownTableBodyLeft">A modified version of the standard generated DriverWizard INF file for your device, which registers your device with your driver (<code>xxx.sys</code>).You can make additional modifications to this file, if you wish, such as changing the manufacturer or driver provider strings.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>wdapi1511.dll</code>   </td><td class="markdownTableBodyLeft">A copy of the WinDriver-API DLL. The DLL is copied here in order to simplify the driver distribution, allowing you to use the generated <code>xxx\redist</code> directory as the main installation directory for your driver, instead of the original <code>WinDriver\redist</code> directory.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>wdreg.exe</code>, <code>wdreg_gui.exe</code>, and <code>devcon.exe</code>   </td><td class="markdownTableBodyLeft">Copies of the CUI and GUI versions of the wdreg WinDriver driver installation utility, and the Device Console app required by this utility, (respectively). These files are copied from the <code>WinDriver\util</code> directory, to simplify the installation of the renamed driver.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>xxx_install.bat</code>   </td><td class="markdownTableBodyLeft">An installation script that executes the wdreg commands for installing the <code>xxx_driver.inf</code> and <code>xxx_device.inf</code> files. This script is designed to simplify the installation of the renamed <code>xxx_driver.sys</code> driver, and the registration of your device with this driver.   </td></tr>
</table>
</li>
<li><code>sys</code> directory: <br  />
 This directory contains files for advanced users, who wish to change the properties of their driver file. Changing the file's properties requires rebuilding of the driver module using the Windows Driver Kit (WDK). <br  />
 To modify the properties of your <code>xxx.sys</code> driver file:<ul>
<li>Verify that you have WDK 8 or above and its corresponding Windows SDK installed on your development PC.</li>
<li>Modify the <code>xxx.rc</code> resources file in the generated sys directory in order to set different driver file properties.</li>
<li>Compile <code>xxx.vcxproj</code> with MsBuild or Visual Studio.</li>
<li>After rebuilding the <code>xxx.sys</code> driver, copy the new driver file to the generated <code>xxx_installation\redist</code> directory.</li>
</ul>
</li>
</ul>
</li>
<li>Verify that your user-mode application calls the <a class="el" href="windrvr_8h_aa9bbb693e0e73c7bc1aa910109be8b8c.html#aa9bbb693e0e73c7bc1aa910109be8b8c" title="Sets the name of the WinDriver kernel module, which will be used by the calling application.">WD_DriverName()</a> function with your new driver name before calling any other WinDriver function. Note that the sample and generated DriverWizard WinDriver applications already include a call to this function, but with the default driver name (<code>windrvr1511</code>), so all you need to do is replace the driver name that is passed to the function in the code with your new driver name.</li>
<li>Verify that your user-mode driver project is built with the <code>WD_DRIVER_NAME_CHANGE</code> preprocessor flag (e.g., <code>-DWD_DRIVER_NAME_CHANGE</code>). Note: The sample and generated DriverWizard WinDriver kernel projects/makefiles already set this preprocessor flag by default.</li>
<li>Install your new driver by following the instructions in <a class="el" href="ch15_distributing_your_driver.html#ch15_2_windows_driver_distribution">15.2. Windows Driver Distribution</a> of the manual, using the modified files from the generated <code>xxx_installation</code> directory instead of the installation files from the original WinDriver distribution. Note that you can use the generated <code>xxx_install.bat</code> installation script to simplify the installation.</li>
</ul>
<h3><a class="anchor" id="ch17_2_1_1_rebuilding_with_custom_version_information_windows"></a>
17.2.1.1 Rebuilding with Custom Version Information (Windows)</h3>
<p >WinDriver for Windows allows building your driver with custom version information (Provider, Date, Version, etc‚Ä¶). This information can be seen upon entering the Device Properties of your device in the Device Manager or by right-clicking the driver binary and selecting the ‚ÄúDetails‚Äù tab.</p>
<p >Visual Studio is required in order to perform the following procedure. In the following instructions xxx stands for your generated driver name.</p>
<ul>
<li>In your generated code folder go to the <code>xxx_installation\sys</code> subfolder.</li>
<li>Edit <code>xxx.rc</code> and modify the details in it to suit your needs.</li>
<li>Open the <code>xxx.vcxproj</code> with Visual Studio and build the project. Make sure you compile the driver in Release configuration for your platform (32 or 64 bits).</li>
<li>The resulting <code>xxx.sys</code> file should include your custom version information.</li>
</ul>
<h2><a class="anchor" id="ch17_2_2_linux_driver_renaming"></a>
17.2.2. Linux Driver Renaming</h2>
<p >DriverWizard automates most of the work of renaming the Linux WinDriver kernel driver ‚Äî <code>windrvr1511.ko</code>.</p>
<blockquote class="doxtable">
<p >&zwj;<b>‚ö† Attention</b></p>
<blockquote class="doxtable">
<p >&zwj;References to xxx in this section should be replaced with the name of your generated DriverWizard driver project. </p>
</blockquote>
</blockquote>
<p>To rename your Linux WinDriver kernel driver, follow these steps:</p><ul>
<li>Use the DriverWizard utility to generate driver code for your hardware on Linux <br  />
 (refer to <a class="el" href="ch6_using_driverwizard.html#ch6_2_driverwizard_walkthrough">6.2. DriverWizard Walkthrough</a>), using your preferred driver name (xxx) as the name of the generated driver project. The generated project directory (xxx) will include an <code>xxx_installation</code> directory with the following files and directories:</li>
</ul>
<p ><b>redist</b> directory: This directory contains copies of the files from the original <code>WinDriver/redist</code> installation directory, but with the required modifications for building your <code>xxx.ko</code> driver instead of <code>windrvr1511.ko</code>. <b>lib</b> and <b>include</b> directories: Copies of the library and include directories from the original WinDriver distribution. These copies are created since the supported Linux WinDriver kernel driver build method relies on the existence of these directories directly under the same parent directory as the redist directory.</p>
<ul>
<li>Verify that your user-mode application calls the <a class="el" href="windrvr_8h_aa9bbb693e0e73c7bc1aa910109be8b8c.html#aa9bbb693e0e73c7bc1aa910109be8b8c" title="Sets the name of the WinDriver kernel module, which will be used by the calling application.">WD_DriverName()</a> function with your new driver name before calling any other WinDriver function. Note that the sample and generated DriverWizard WinDriver applications already include a call to this function, but with the default driver name (<code>windrvr1511</code>), so all you need to do is replace the driver name that is passed to the function in the code with your new driver name.</li>
<li>Verify that your user-mode driver project is built with the <code>WD_DRIVER_NAME_CHANGE</code> preprocessor flag (<code>-DWD_DRIVER_NAME_CHANGE</code>). Note that the sample and generated DriverWizard WinDriver kernel projects/makefiles already set this preprocessor flag by default. If you have created a Kernel PlugIn driver, you will need to add this flag by uncommenting the following line in the Kernel PlugIn driver's configuration script:</li>
</ul>
<div class="fragment"><div class="line"># ADDITIONAL_FLAGS=&quot;-DWD_DRIVER_NAME_CHANGE&quot;</div>
</div><!-- fragment --><ul>
<li>Install your new driver by following the instructions in <a class="el" href="ch15_distributing_your_driver.html#ch15_3_linux_driver_distribution">15.3. Linux Driver Distribution</a> of the manual, using the modified files from the generated xxx_installation directory instead of the installation files from the original WinDriver distribution.</li>
</ul>
<p >As part of the installation, build your new kernel driver module(s) by following the instructions in <br  />
 <a class="el" href="ch15_distributing_your_driver.html#ch15_3_linux_driver_distribution">15.3. Linux Driver Distribution</a>, using the files from your new installation directory.</p>
<h1><a class="anchor" id="ch17_3_windows_digital_driver_signing_and_certification"></a>
17.3. Windows Digital Driver Signing and Certification</h1>
<h2><a class="anchor" id="ch17_3_1_windows_digital_driver_signing_and_certification_overview"></a>
17.3.1. Windows Digital Driver Signing and Certification Overview</h2>
<p >Before distributing your driver, you may digitally sign it using Microsoft's Authenticode mechanism, and/or certify it by submitting it to Microsoft's Windows Certification Program (HLK/HCK/WLP).</p>
<p >Some Windows operating systems, do not require installed drivers to be digitally signed or certified. Only a popup with a warning will appear. There are, however, advantages to getting your driver digitally signed or fully certified, including the following:</p><ul>
<li>Driver installation on systems where installing unsigned drivers has been blocked.</li>
<li>Avoiding warnings during driver installation.</li>
<li>Full pre-installation of INF files.</li>
</ul>
<p >64-bit versions of Windows 8 and higher require Kernel-Mode Code Signing (KMCS) of software that loads in kernel mode. This has the following implications for WinDriver-based drivers:</p><ul>
<li>Drivers that are installed via an INF file must be distributed together with a signed catalog file. During driver development, please configure your Windows OS to temporarily allow the installation of unsigned drivers.</li>
</ul>
<p >For more information about digital driver signing and certification, refer to the following documentation in the Microsoft Development Network (MSDN) library:</p><ul>
<li>Driver Signing Requirements for Windows.</li>
<li>Introduction to Code Signing.</li>
<li>Digital Signatures for Kernel Modules on Windows.</li>
</ul>
<p >This white paper contains information about kernel-mode code signing, test signing, and disabling signature enforcement during development.</p>
<ul>
<li><a href="https://msdn.microsoft.com/en-us/windows-drivers/develop/signing_a_driver">https://msdn.microsoft.com/en-us/windows-drivers/develop/signing_a_driver</a></li>
</ul>
<p >Some of the documentation may still use old terminology. For example, references to the Windows Logo Program (WLP) or to the Windows Hardware Quality Labs (WHQL) or to the Windows Certification Program or to the Windows Hardware Certification Kit (HCK) should be replaced with the Windows Hardware Lab Kit (HLK), and references to the Windows Quality Online Services (Winqual) should be replaced with the Windows Dev Center Hardware Dashboard Services (the Hardware Dashboard).</p>
<h3><a class="anchor" id="ch17_3_1_1_authenticode_driver_signature"></a>
17.3.1.1. Authenticode Driver Signature</h3>
<p >The Microsoft Authenticode mechanism verifies the authenticity of a driver's provider. It allows driver developers to include information about themselves and their code with their programs through the use of digital signatures, and informs users of the driver that the driver's publisher is participating in an infrastructure of trusted entities.</p>
<p >The Authenticode signature does not, however, guarantee the code's safety or functionality.</p>
<p >The <code>WinDriver\redist\windrvr1511.sys</code> driver has an Authenticode digital signature.</p>
<h3><a class="anchor" id="ch17_3_1_2_windows_certification_program"></a>
17.3.1.2. Windows Certification Program</h3>
<p >Microsoft's Windows Certification Program (previously known as the Windows Logo Program (WLP)), lays out procedures for submitting hardware and software modules, including drivers, for Microsoft quality assurance tests. Passing the tests qualifies the hardware/software for Microsoft certification, which verifies both the driver provider's authenticity and the driver's safety and functionality.</p>
<p >To digitally sign and certify a device driver, a Windows Hardware Lab Kit (HLK) package, which includes the driver and the related hardware, should be submitted to the Windows Certification Program for testing, using the Windows Dev Center Hardware Dashboard Services (the Hardware Dashboard).</p>
<p >Jungo's professional services unit provides a complete Windows driver certification service for Jungo-based drivers. Professional engineers efficiently perform all the tests required by the Windows Certification Program, relieving customers of the expense and stress of in-house testing. Jungo prepares an HLK / HCK submission package containing the test results, and delivers the package to the customer, ready for submission to Microsoft.</p>
<p >For more information, refer to <a href="https://www.jungo.com/st/services/windows_drivers_certification/">https://www.jungo.com/st/services/windows_drivers_certification/</a>.</p>
<p >For detailed information regarding Microsoft's Windows Certification Program and the certification process, refer to the MSDN Windows Hardware Certification page ‚Äî <a href="https://msdn.microsoft.com/library/windows/hardware/gg463010.aspx">https://msdn.microsoft.com/library/windows/hardware/gg463010.aspx</a> ‚Äî and to the documentation referenced from that page, including the MSDN Windows Dev Center ‚Äî Hardware Dashboard Services page ‚Äî <a href="https://msdn.microsoft.com/library/windows/hardware/gg463091">https://msdn.microsoft.com/library/windows/hardware/gg463091</a>.</p>
<h2><a class="anchor" id="ch17_3_2_driver_signing_and_certification_of_windriver-based_drivers"></a>
17.3.2. Driver Signing and Certification of WinDriver-Based Drivers</h2>
<p >As indicated above, The <code>WinDriver\redist\windrvr1511.sys</code> driver has an embedded Authenticode signature. Since WinDriver's kernel module (<code>windrvr1511.sys</code>) is a generic driver, which can be used as a driver for different types of hardware devices, it cannot be submitted to Microsoft's Windows Certification Program as a standalone driver. However, once you have used WinDriver to develop a Windows driver for your selected hardware, you can submit both the hardware and driver for Microsoft certification, as explained below.</p>
<p >The driver certification and signature procedures ‚Äî either via Authenticode or the Windows Certification Program ‚Äî require the creation of a catalog file for the driver. This file is a sort of hash, which describes other files. The signed <code>windrvr1511.sys</code> driver is provided with a matching catalog file ‚Äî <code>WinDriver\redist\windrvr1511.cat</code>. This file is assigned to the CatalogFile entry in the <code>windrvr1511.inf</code> file (provided as well in the redist directory). This entry is used to inform Windows of the driver's signature and the relevant catalog file during the driver's installation.</p>
<p >When the name, contents, or even the date of the files described in a driver's catalog file is modified, the catalog file, and consequently the driver signature associated with it, become invalid. Therefore, if you select to rename the <code>windrvr1511.sys</code> driver (<a class="el" href="ch17_driver_installation_advanced_issues.html#ch17_2_renaming_the_windriver_kernel_driver">17.2. Renaming the WinDriver Kernel Driver</a>) and/or the related <code>windrvr1511.inf</code> file, the <code>windrvr1511.cat</code> catalog file and the related driver signature will become invalid.</p>
<p >In addition, when using WinDriver to develop a driver for your Plug-and-Play device, you normally also create a device-specific INF file that registers your device to work with the <code>windrvr1511.sys</code> driver module (or a renamed version of this driver). Since this INF file is created at your site, for your specific hardware, it is not referenced from the <code>windrvr1511.cat</code> catalog file and cannot be signed by Jungo a priori.</p>
<p >When renaming <code>windrvr1511.sys</code> and/or creating a device-specific INF file for your device, you have two alternative options regarding your driver's digital signing:</p>
<ul>
<li>Do not digitally sign your driver. If you select this option, remove or comment-out the reference to the <code>windrvr1511.cat</code> file from the <code>windrvr1511.inf</code> file (or your renamed version of this file).</li>
<li>Submit your driver to the Windows Certification Program, or have it Authenticode signed.</li>
</ul>
<p >Note that while renaming <code>WinDriver\redist\windrvr1511.sys</code> nullifies the driver's digital signature, the driver is still compliant with the certification requirements of the Windows Certification Program.</p>
<p >To digitally sign/certify your driver, follow these steps:</p>
<ul>
<li>Create a new catalog file for your driver, as explained in the Windows Certification Program documentation. The new file should reference both <code>windrvr1511.sys</code> (or your renamed driver) and any INF files used in your driver's installation.</li>
<li>Assign the name of your new catalog file to the CatalogFile entry in your driver's INF file(s). (You can either change the CatalogFile entry in the <code>windrvr1511.inf</code> file to refer to your new catalog file, and add a similar entry in your device-specific INF file; or incorporate both <code>windrvr1511.inf</code> and your device INF file into a single INF file that contains such a CatalogFile entry).</li>
<li>Submit your driver to Microsoft's Windows Certification Program or for an Authenticode signature. If you wish to submit your driver to the Windows Certification Program, refer to the additional guidelines in <a class="el" href="ch17_driver_installation_advanced_issues.html#ch17_3_2_1_hck-hlk_test_notes">17.3.2.1. HCK/HLK Test Notes</a>.</li>
</ul>
<p >Many WinDriver customers have already successfully digitally signed and certified their WinDriver-based drivers.</p>
<h3><a class="anchor" id="ch17_3_2_1_hck-hlk_test_notes"></a>
17.3.2.1. HCK/HLK Test Notes</h3>
<p >As indicated in Microsoft's documentation, before submitting the driver for testing and certification you need to download the Windows Hardware Certification Kit (HCK) (for Windows 8) or the Windows Hardware Lab Kit (HLK) (for Windows 10), and run the relevant tests for your hardware/software. After you have verified that you can successfully pass the HCK/HLK tests, create the required logs package and proceed according to Microsoft's documentation.</p>
<p >For more information, refer to the MSDN Windows Hardware Certification Kit (HCK) page ‚Äî <a href="https://msdn.microsoft.com/library/windows/hardware/hh833788">https://msdn.microsoft.com/library/windows/hardware/hh833788</a>.</p>
<h2><a class="anchor" id="ch17_3_3_secure_boot_and_driver_development"></a>
17.3.3. Secure Boot and Driver Development</h2>
<p >Secure boot is a security standard developed by Microsoft to help make sure that a PC boots using only software that is trusted by the Original Equipment Manufacturer (OEM). When the PC starts, the firmware checks the signature of each piece of boot software (UEFI, EFI apps, etc.) and blocks the loading of unsigned drivers.</p>
<blockquote class="doxtable">
<p >&zwj;<b>‚ö† Attention</b></p>
<blockquote class="doxtable">
<p >&zwj;Disabling Secure Boot and Digital signature enforcement is recommended during driver development and testing. However, a signed driver (Attestation Signing or HLK/WHQL) is required in order to install the driver after it has been distributed. </p>
</blockquote>
</blockquote>
<p>You can check if Secure Boot is enabled on your system by following one of the procedures below:</p>
<h3><a class="anchor" id="ch17_3_3_1_through_system_information"></a>
17.3.3.1. Through System Information</h3>
<ul>
<li>Press on Windows + R to open Run window.</li>
</ul>
<p ><b>Run window</b></p>
<div class="image">
<img src="runMsinfo.jpg" alt=""/>
</div>
 <ul>
<li>Run msinfo32.exe to open the system information.</li>
<li>Look for ‚ÄúSecure Boot State and check its status under ‚ÄúSystem Summary‚Äù.</li>
</ul>
<p ><b>System Information</b></p>
<div class="image">
<img src="systemInfo-1.jpg" alt=""/>
</div>
 <ul>
<li>If the state is ‚ÄúOff‚Äù / ‚ÄúUnsupported‚Äù or if ‚ÄúSecure Boot State‚Äù is not listed under ‚ÄúSystem Summary‚Äù ‚Äì that means that Secure Boot is disabled.</li>
</ul>
<h3><a class="anchor" id="ch17_3_3_2_through_powershell"></a>
17.3.3.2. Through PowerShell</h3>
<ul>
<li>Open PowerShell with administrator privileges.</li>
<li>Enter the command <code>Confirm-SecureBootUEFI</code> and press Enter.</li>
</ul>
<p ><b>PowerShell</b></p>
<div class="image">
<img src="SBPowerSHell.jpg" alt=""/>
</div>
 <ul>
<li>Any result other than True means that Secure Boot is disabled</li>
</ul>
<h3><a class="anchor" id="ch17_3_3_3_through_windriver_user-mode_api"></a>
17.3.3.3. Through WinDriver User-Mode API</h3>
<p >Starting from WinDriver 12.8 the user-mode API (e.g. <code>wdapi1280.dll</code>) <br  />
 includes the function <code><a class="el" href="windrvr_8h_aa36a2f0f12bffe1f842378678566c1a0.html#aa36a2f0f12bffe1f842378678566c1a0" title="Checks whether the Secure Boot feature is enabled on the system.">check_secureBoot_enabled()</a></code> that can be used as follows:</p>
<div class="fragment"><div class="line">DWORD dwStatus = <a class="code hl_function" href="windrvr_8h_aa36a2f0f12bffe1f842378678566c1a0.html#aa36a2f0f12bffe1f842378678566c1a0">check_secureBoot_enabled</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (dwStatus == <a class="code hl_enumvalue" href="windrvr_8h_a4be61f088cf6870c6ff37ab94aba215c.html#a4be61f088cf6870c6ff37ab94aba215caba582ffa048363d9da768914de1d5c41">WD_STATUS_SUCCESS</a>)</div>
<div class="line">    printf(<span class="stringliteral">&quot;Secure Boot is enabled&quot;</span>);</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Secure Boot is disabled / unsupported&quot;</span>);</div>
<div class="ttc" id="awindrvr_8h_a4be61f088cf6870c6ff37ab94aba215c_html_a4be61f088cf6870c6ff37ab94aba215caba582ffa048363d9da768914de1d5c41"><div class="ttname"><a href="windrvr_8h_a4be61f088cf6870c6ff37ab94aba215c.html#a4be61f088cf6870c6ff37ab94aba215caba582ffa048363d9da768914de1d5c41">WD_STATUS_SUCCESS</a></div><div class="ttdeci">@ WD_STATUS_SUCCESS</div><div class="ttdoc">[0] Operation completed successfully</div><div class="ttdef"><b>Definition:</b> <a href="windrvr_8h_source.html#l01041">windrvr.h:1041</a></div></div>
<div class="ttc" id="awindrvr_8h_aa36a2f0f12bffe1f842378678566c1a0_html_aa36a2f0f12bffe1f842378678566c1a0"><div class="ttname"><a href="windrvr_8h_aa36a2f0f12bffe1f842378678566c1a0.html#aa36a2f0f12bffe1f842378678566c1a0">check_secureBoot_enabled</a></div><div class="ttdeci">DWORD DLLCALLCONV check_secureBoot_enabled(void)</div><div class="ttdoc">Checks whether the Secure Boot feature is enabled on the system.</div></div>
</div><!-- fragment --><h3><a class="anchor" id="ch17_3_3_4_disabling_secure_boot"></a>
17.3.3.4. Disabling Secure Boot</h3>
<p >In order to install and load unsigned drivers Secure Boot must be disabled.</p>
<p >Secure Boot can be disabled as follows:</p><ul>
<li>Open PC BIOS menu (this can be done by restarting your PC).</li>
<li>Find the Secure Boot setting (usually under ‚ÄúBoot Manager‚Äù) and set it to ‚ÄúDisabled‚Äù.</li>
<li>Save the settings and Exit. PC will reboot.</li>
</ul>
<p >For more information on Secure Boot setting, please see Microsoft Documentation.</p>
<h2><a class="anchor" id="ch17_3_4_temporary_disabling_digital_signature_enforcement_in_windows_10"></a>
17.3.4. Temporary disabling digital signature enforcement in Windows 10</h2>
<p >Windows 10 (and other Windows versions) requires kernel drivers to be digitally signed. The WinDriver virtual device, which is installed during WinDriver installation process, is digitally signed. However, INF files that are generated by the DriverWizard utility are not signed and therefore will fail to install on Windows 10. In order to install them, it is required to digitally sign them. To bypass this requirement, it is possible to temporarily disable digital driver signing enforcement and install your INF file while the enforcement is disabled.</p>
<p >You can do this by following the procedure below:</p>
<ul>
<li>Click on the Start menu button.</li>
<li>Hold down the Shift button in the keyboard, and click the Power icon on the left side of the Start menu.</li>
<li>From the menu that will open, choose Restart.</li>
<li>In the screen that will open, choose Troubleshoot.</li>
<li>Choose Advanced options.</li>
<li>Choose Start-up Settings.</li>
<li>The computer will restart and load a Startup Settings screen. Press F7 to disable driver signature enforcement.</li>
<li>Your INF should install successfully.</li>
</ul>
<p >This operation mode (Disabled Digital Signature Enforcement), which allows you to freely install INF files generated by WinDriver, will last until the next reboot. Your newly installed INF files should work properly even after the Digital Signature Enforcement will automatically be switched on again in the next reboot. Other ways are available to permanently disable Digital Signature Enforcement, and are dependent on your Windows version. Full explanation for these ways can be found online.</p>
<blockquote class="doxtable">
<p >&zwj;<b>‚ÑπÔ∏è Note</b></p>
<blockquote class="doxtable">
<p >&zwj;Jungo provides Digital Signature Services for drivers developed with WinDriver. In order to find ore information, please send us an e-mail to <a href="#" onclick="location.href='mai'+'lto:'+'sal'+'es'+'@ju'+'ng'+'o.c'+'om'; return false;">sales<span class="obfuscator">.nosp@m.</span>@jun<span class="obfuscator">.nosp@m.</span>go.co<span class="obfuscator">.nosp@m.</span>m</a>. </p>
</blockquote>
</blockquote>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
